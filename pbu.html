<html>
<body>
<div id="first" style="clear: both; text-align: center;">
<h1>
Success...!!!</h1>
<!--
<a href="https://cdn.instructables.com/FWA/9JHC/IX6FV7HW/FWA9JHCIX6FV7HW.LARGE.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="255" src="https://cdn.instructables.com/FWA/9JHC/IX6FV7HW/FWA9JHCIX6FV7HW.LARGE.jpg" width="400" /></a><br />
-->
<b> Your 20 character Authorization Code is... </b>
<h2 id="auth">
</h2> 
Please use above Authorization Code to Validate your Device with Amazon DRS<br /><br />
Please click to email Authorization Code to: <a href="mailto:stephen.kobs@gapac.com?subject=PBU Auth Grant&body=Paste Authorization Grant Code Below%0D%0A">stephen.kobs@gapac.com</a>
<br />
</div>
<div id="myDiv" style="clear: both; text-align: center;">
<h1>
Register Device with Amazon DRS</h1>
<!--
<a href="https://cdn.instructables.com/FWA/9JHC/IX6FV7HW/FWA9JHCIX6FV7HW.LARGE.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="330" src="https://cdn.instructables.com/FWA/9JHC/IX6FV7HW/FWA9JHCIX6FV7HW.LARGE.jpg" width="500" /></a>
  -->
<form action="form_action.asp" id="frm1">
  <b>PRODUCT MODEL ID </b> <br /> 
  <!--
  <input maxlength="36" name="pname" size="38" style="text-align: center;" type="text" value="PBU_Towel" /><br /><br />
  -->
  <select name="model">
  	<option value="PBU_Towel">PBU Towel</option>
  	<option value="Retail_Towel">Retail Towel</option>
  </select> 
  <br><br>
  <b>SERIAL NO </b><br /> <input maxlength="12" name="sname" size="14" style="text-align: center;" type="text" value="pbu0001" /><br /><br />
  <input type="checkbox" name="test_device" value="1" checked> DRS Device Test (not live)<br> <br>
  <input type="radio" name="testactive" value="true" checked> DRS Test Only<br> <input type="radio" name="testactive" value="false"> DRS Activate<br><br>
  <input onclick="lwaFunction()" type="button" value="Login with Amazon" /><br><br>

</form>
</div>
<br />
<br />

<script>
function defFunction() {
    var str = String(window.location);
    var pos = str.indexOf("code=");
    if(pos != -1)
    {
       myDiv.style.display = "none";
       var str = String(window.location);
       var res = str.substring(pos+5,pos+25);
       document.getElementById("auth").innerHTML = res;
    }
}
function lwaFunction() {
    var str = String(window.location);
    var pos = str.indexOf("code=");
    if(pos == -1)
    {
        var x1 = document.getElementById("frm1");
        var productid = String(x1.elements[0].value);
        var serialno = String(x1.elements[1].value);
        var device_not_active = String(x1.elements[2].value);
        var test_device_radio = String(x1.elements[3].value);
        var sel_radio = document.getElementById("testactive").value;
        alert("radio="sel_radio+"  test_device_radio="+test_device_radio+" device_not_active="+device_not_active);

        var test_device = "true"
        if(device_not_active != "1")
        {
        	test_device = "false"
        }
        var redir_uri = "https://shark0967.github.io/DRSAuthTest/pbu.html"
        window.open("https://www.amazon.com/ap/oa?client_id=amzn1.application-oa2-client.1647b50d31d34f808cd3c84638e327fa&scope=dash%3Areplenish&scope_data=%7B%22dash%3Areplenish%22%3A%7B%22device_model%22%3A%22"+productid+"%22%2C%22serial%22%3A%22"+serialno+"%22%2C%22is_test_device%22%3A%22"+test_device+"%22%7D%7D&response_type=code&redirect_uri="+redir_uri);
    }
}
function fstFunction() {
    var str = String(window.location);
    var pos = str.indexOf("code=");
    if(pos == -1)
    {
        first.style.display = "none";
    }
}
defFunction();
fstFunction() 
</script>
</body>

</html>